<!DOCTYPE html>
<html lang="en">
<head>
    <title>Scrum Master</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Helvetica, Sans-Serif, sans-serif;
            font-size: 12px;
        }

        h5 {
            font-size: 14px;
            margin-top: 10px;
            margin-bottom: 3px;
        }
    </style>
</head>
<body>
<div id="today" style="font-weight: 600;"></div>
<h5 id="firstWeekTitle">1.</h5>
<div id="firstWeek"></div>

<h5 id="secondWeekTitle">2.</h5>
<div id="secondWeek"></div>

<script>
    const specialDays = [
        {
            start: new Date(2023, 11, 4),
            end: new Date(2023, 11, 8),
            scrumMaster: "Radovan Škorić"
        },
    ];

    function isSpecialDay(date) {
        for (let day of specialDays) {
            if (date >= day.start && date <= day.end) {
                return day.scrumMaster;
            }
        }
        return null;
    }
    
    function generateWeeks(selector, teamMembers, today, isActiveWeek) {
        const todayDay = today.getDay();
        const dayElement = document.querySelector(selector);
        const specialScrumMaster = isSpecialDay(today);

        for (let i = 0; i < daysOfWeek().length - 2; i++) {
            let text = getDayOfWeek(i).substring(0, 3);

            if (specialScrumMaster) {
                text += ` - ${specialScrumMaster}`;
            } else if (teamMembers && teamMembers[i]) {
                text += ` - ${teamMembers[i]}`;
            }

            if (isActiveWeek && todayDay === (i + 1)) {
                text = `<b style="color: darkgreen; font-weight: 900;">${text}</b>`;
            }

            dayElement.innerHTML += `${text}<br>`;
        }
    }

    function updateTitleWithWeekNumber(selector, firstDay, isActiveWeek) {
        const lastDay = addDays(firstDay, 4);
        const titleElement = document.querySelector(selector);
        titleElement.style.fontWeight = isActiveWeek ? 'bold' : 'normal';
        titleElement.innerHTML += `Week ${formatDate(firstDay)}-${formatDate(lastDay)}:`;
    }
    
    function updateToday(date) {
        const todayElement = document.querySelector("#today");
        todayElement.innerHTML = `${formatDate(date)}.${date.getFullYear()} - ${getDayOfWeek((date.getDay()+6)%7)}`;
    }

    function getMonday(d) {
        const day = d.getDay();
        const diff = d.getDate() - day + (day === 0 ? -6 : 1);
        return new Date(d.setDate(diff));
    }

    function formatDate(date) {
        return `${date.getDate()}.${date.getMonth() + 1}`;
    }

    function CurrentWeekNumberFromFixedDate(date) {
        return Math.ceil((date - new Date(2023, 0, 1)) / 604800000);
    }
    
    function IsFirstWeekCurrentWeek(date) {
        return CurrentWeekNumberFromFixedDate(date) % 2 === 0;
    }

    function addDays(date, days) {
        const newDate = new Date(date);
        newDate.setDate(newDate.getDate() + days);
        return newDate;
    }
    
    function getDayOfWeek(day) {
        return daysOfWeek()[day];
    }
    
    function daysOfWeek() {
        return ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
    }

    const today = addDays(new Date(), 0);
    updateToday(today);

    const isFirstWeekCurrentWeek = IsFirstWeekCurrentWeek(today);
    const isSecondWeekCurrentWeek = !isFirstWeekCurrentWeek;

    const firstWeekTeamMembers = ["Srđan Đilas", "Srđan Jokić", "Milan Lukić", "Siniša Radin", "Nemanja Svorcan"];
    const secondWeekTeamMembers = ["Radovan Škorić", "Milan Stojanović", "Mladen Arbutina", "Milan Stojanović", "Mladen Arbutina"];

    generateWeeks("#firstWeek", firstWeekTeamMembers, today, isFirstWeekCurrentWeek);
    generateWeeks("#secondWeek", secondWeekTeamMembers, today, isSecondWeekCurrentWeek);

    const thisMonday = getMonday(today);
    const firstMonday = isFirstWeekCurrentWeek ? new Date(thisMonday) : addDays(thisMonday, -7);
    const secondMonday = isSecondWeekCurrentWeek ? new Date(thisMonday) : addDays(thisMonday, 7)

    updateTitleWithWeekNumber("#firstWeekTitle", firstMonday, isFirstWeekCurrentWeek);
    updateTitleWithWeekNumber("#secondWeekTitle", secondMonday, isSecondWeekCurrentWeek);
</script>
</body>
</html>
